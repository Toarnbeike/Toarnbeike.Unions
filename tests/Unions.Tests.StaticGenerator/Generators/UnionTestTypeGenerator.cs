using Toarnbeike.Unions.Utitilies;

namespace Toarnbeike.Unions.Generators;

/// <summary>
/// Generates helper records U1..Un, for use in actual tests.
/// This code is build-time tooling; readability and determinism are preferred over abstraction.
/// </summary>
internal static class UnionTestTypeGenerator
{
    public static string Generate(int maxArity)
    {
        return $"""
            {AutoGeneratedMessageGenerator.GetAutoGeneratedMessage(nameof(UnionTestTypeGenerator))}

            namespace Toarnbeike.Unions.Tests.Unions.TestTypes;

            /*
             * These records are used as test types.
             * Each U[n] will be used as the generic type argument T[n] in Union tests.
             */

            {string.Join("\n", Enumerable.Range(1, maxArity).Select(GenerateTestType))}

            /// <summary>
            /// Exception that is thrown when an assertion that a given function should not be invoked fails.
            /// </summary>
            internal sealed class ShouldNotBeCalledException() : Exception("This function should not be called.");
            """;
    }

    private static string GenerateTestType(int arity)
    {
        return $"public sealed record U{arity}(int Value);";
    }
}
