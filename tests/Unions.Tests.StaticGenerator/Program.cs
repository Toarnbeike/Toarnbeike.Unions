using Toarnbeike.Unions.Generators;

const int MinArity = 2;
const int MaxArity = 15; // values above 15 are untested, increase at own risk.

Console.WriteLine("Welcome to the Static Union Test Generator");
Console.WriteLine("This tool generates test for the Unions generated by the Static Union Generator");

Console.WriteLine("\nPlease indicate the maximum arity to generate (matching the created arities).");

while (true)
{
    var input = Console.ReadLine();
    var isValid = int.TryParse(input, out var parsedArity) && parsedArity >= MinArity && parsedArity <= MaxArity;
    if (isValid)
    {
        return GenerateTests(parsedArity);
    }
    Console.WriteLine($"Invalid input. Please enter a number between {MinArity} and {MaxArity}:");
}

static int GenerateTests(int maxArity)
{
    var range = Enumerable.Range(2, maxArity - 1).ToArray();  // arities from 2 to upperBound inclusive
    var outputRoot = "../../../../Unions.Tests"; // location to write generated test files

    Console.WriteLine("\nGenerating union test types");
    var unionTestTypes = UnionTestTypeGenerator.Generate(maxArity);
    File.WriteAllText(Path.Join(outputRoot, "TestTypes/UnionTestTypes.cs"), unionTestTypes);

    Console.WriteLine("\nGenerating union tests");
    foreach (var arity in range)
    {
        var unionTests = UnionTestGenerator.Generate(arity);
        File.WriteAllText(Path.Join(outputRoot, $"Unions/Generated/Union{arity:D2}Tests.cs"), unionTests);
    }

    Console.WriteLine("Generating match extensions tests");
    foreach (var arity in range)
    {
        var matchTests = MatchExtensionsTestsGenerator.Generate(arity);
        File.WriteAllText(Path.Join(outputRoot, $"Extensions/Match/Generated/Match{arity:D2}Tests.cs"), matchTests);
    }

    Console.WriteLine("Generating switch extensions tests");
    foreach (var arity in range)
    {
        var switchTests = SwitchExtensionsTestsGenerator.Generate(arity);
        File.WriteAllText(Path.Join(outputRoot, $"Extensions/Switch/Generated/Switch{arity:D2}Tests.cs"), switchTests);
    }

    Console.WriteLine("Generating switch extensions tests");
    foreach (var arity in range)
    {
        var testExtensionsTests = TestExtensionsTestsGenerator.Generate(arity);
        File.WriteAllText(Path.Join(outputRoot, $"TestExtensions/Generated/TestExtensions{arity:D2}Tests.cs"), testExtensionsTests);
    }

    Console.WriteLine("\nTest generation completed successfully.");

    return 0;
}
